#!/bin/bash

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${GREEN}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
echo -e "${GREEN}   PERFORMANCE STATUS MONITOR - PROFESSIONAL 10/10     ${NC}"
echo -e "${GREEN}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è Python
if ! command -v python3 &> /dev/null; then
    echo -e "${RED}[ERROR] Python 3 –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!${NC}"
    echo "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python 3: sudo apt-get install python3"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ñ–∞–π–ª–∞ –º–æ–Ω–∏—Ç–æ—Ä–∞
if [ ! -f "real_performance_monitor.py" ]; then
    echo -e "${RED}[ERROR] –§–∞–π–ª real_performance_monitor.py –Ω–µ –Ω–∞–π–¥–µ–Ω!${NC}"
    echo "–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏."
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—â–µ–Ω –ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç
if ! pgrep -f "production_multi_exchange_bot.py" > /dev/null; then
    echo -e "${YELLOW}[WARNING] –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω!${NC}"
    echo -e "${YELLOW}–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞: python3 production_multi_exchange_bot.py${NC}"
    echo ""
    read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤—Å–µ —Ä–∞–≤–Ω–æ? (y/n): " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 1
    fi
fi

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤ –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
mkdir -p logs

# –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∞
echo -e "${GREEN}[SUCCESS] –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã!${NC}"
echo -e "${GREEN}[INFO] –ó–∞–ø—É—Å–∫–∞—é Performance Monitor —Å –ø—Ä–æ—Ñ. –ø–æ—Ä–æ–≥–∞–º–∏ 10/10...${NC}"
echo ""
echo -e "${YELLOW}–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏:${NC}"
echo "  ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö: ‚â•95%"
echo "  ‚úÖ –ß–∞—Å—Ç–æ—Ç–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: ‚â•1 Hz"
echo "  ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏: ‚â•5 –≤ —á–∞—Å / ‚â•1 –≤ 10 –º–∏–Ω—É—Ç"
echo "  ‚úÖ Win Rate: ‚â•60%"
echo "  ‚úÖ –°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å: ‚â•$1"
echo ""
echo -e "${YELLOW}–ì—Ä–∞—Ñ–∏–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:${NC}"
echo "  00:00-00:15 - –ó–∞–ø—É—Å–∫ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞"
echo "  00:15-01:00 - –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –ø–µ—Ä–≤—ã–º–∏ —Å–¥–µ–ª–∫–∞–º–∏"
echo "  01:00-02:00 - –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"
echo "  02:00+ - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏"
echo ""
echo -e "${YELLOW}–î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C${NC}"
echo -e "${YELLOW}‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê${NC}"
echo ""

# –ó–∞–ø—É—Å–∫ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
python3 -u real_performance_monitor.py 2>&1 | tee -a logs/performance_monitor_$(date +%Y%m%d_%H%M%S).log

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–¥–∞ –≤—ã—Ö–æ–¥–∞
if [ ${PIPESTATUS[0]} -ne 0 ]; then
    echo ""
    echo -e "${RED}[ERROR] –ú–æ–Ω–∏—Ç–æ—Ä –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π!${NC}"
    echo -e "${YELLOW}–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ logs/${NC}"
    exit 1
else
    echo ""
    echo -e "${GREEN}[INFO] –ú–æ–Ω–∏—Ç–æ—Ä —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω.${NC}"
fi
echo "üìÑ –ü–æ–∏—Å–∫ –ª–æ–≥ —Ñ–∞–π–ª–æ–≤..."
LOG_FILES_FOUND=0

for pattern in "production_bot.log" "critical_*.log" "*.log"; do
    if ls $pattern 1> /dev/null 2>&1; then
        LOG_FILES_FOUND=1
        echo "‚úÖ –ù–∞–π–¥–µ–Ω—ã –ª–æ–≥ —Ñ–∞–π–ª—ã: $pattern"
        break
    fi
done

if [ $LOG_FILES_FOUND -eq 0 ]; then
    echo "‚ö†Ô∏è  –õ–æ–≥ —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ú–æ–Ω–∏—Ç–æ—Ä –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–∞–∑–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏."
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞ –º–æ–Ω–∏—Ç–æ—Ä–∞
if [ ! -f "performance_status_monitor.py" ]; then
    echo "‚ùå –§–∞–π–ª performance_status_monitor.py –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
fi

echo "‚úÖ Performance Status Monitor –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É"
echo ""
echo "üöÄ –ó–∞–ø—É—Å–∫ Performance Status Monitor..."
echo "   –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞ 5 –º–∏–Ω—É—Ç –∏ 1 —á–∞—Å"
echo "   üü¢ –ó–µ–ª–µ–Ω—ã–π = –≤—Å–µ –æ—Ç–ª–∏—á–Ω–æ"
echo "   üü° –ñ–µ–ª—Ç—ã–π = —Ö–æ—Ä–æ—à–æ"  
echo "   üî¥ –ö—Ä–∞—Å–Ω—ã–π = —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è"
echo "   –ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏"
echo ""

# –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∞
python3 performance_status_monitor.py
